<canvas id=canvas width=256 height=240 style="background: #000"></canvas>
<p><input type=file id=file>
<p><b>Controls</b>: arrow keys + A + B + Start + Esc
<script src="https://unpkg.com/jsnes/dist/jsnes.min.js"></script>
<script>e=canvas.getContext("2d"),o=e.getImageData(0,0,256,240),n=new ArrayBuffer(o.data.length),t=new Uint8ClampedArray(n),r=new Uint32Array(n),l=new AudioContext,s=l.createScriptProcessor(512,0,2);s.connect(l.destination),s.onaudioprocess=e=>{if(a.length>C+512)for(var o=0;o<512;o++)e.outputBuffer.getChannelData(0)[o]=a[C],e.outputBuffer.getChannelData(1)[o]=T[C],C++};var a=[],T=[],C=0;file.onchange=()=>{var n=new FileReader;n.readAsBinaryString(file.files[0]),n.onload=()=>{file.remove();var l=new jsnes.NES({onFrame:function(n){for(var l=0,s=0;s<256;++s)for(var a=0;a<240;++a)r[l=256*s+a]=4278190080|n[l];o.data.set(t),e.putImageData(o,0,0)},onAudioSample:function(e,o){a.push(e),T.push(o)},sampleRate:44100});l.loadROM(n.result),setInterval(l.frame,16),onkeydown=onkeyup=n=>{l[n.type[5]?"buttonDown":"buttonUp"](1,jsnes.Controller["BUTTON_"+{37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",88:"A",67:"B",27:"SELECT",13:"START"}[n.keyCode]])}}}</script>